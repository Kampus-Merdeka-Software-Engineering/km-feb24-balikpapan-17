<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Password</title>
    <link rel="stylesheet" href="../css/profile.css" />
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/theme.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11.11.0/dist/sweetalert2.min.css"
      rel="stylesheet"
    />
    <script src="../firebaseConfig.js"></script>
  </head>
  <body>
    <form id="resetPasswordForm" onsubmit="confirmPasswordReset(event)">
      <input
        type="password"
        id="new_password"
        placeholder="New Password"
        required
      />
      <input
        type="password"
        id="confirm_new_password"
        placeholder="Confirm New Password"
        required
      />
      <button type="submit">Reset Password</button>
    </form>

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.11.0/dist/sweetalert2.all.min.js"></script>
    <script src="../js/auth.js"></script>
    <script>
      function confirmPasswordReset(event) {
        event.preventDefault();
        const newPassword = document.getElementById("new_password").value;
        const confirm_new_password = document.getElementById(
          "confirm_new_password"
        ).value;

        if (newPassword !== confirm_new_password) {
          showEModal("Passwords do not match");
          return;
        }

        const actionCode = new URLSearchParams(window.location.search).get(
          "oobCode"
        );

        auth
          .confirmPasswordReset(actionCode, newPassword)
          .then(() => {
            showSucModal("Password has been successfully reset.");

            window.location.href = "./auth.html";
          })
          .catch((error) => {
            console.error("Error resetting password:", error);
            showEModal(error.message);
          });
      }
    </script>
  </body>
</html>
